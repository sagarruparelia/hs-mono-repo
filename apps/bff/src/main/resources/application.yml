spring:
  application:
    name: hs-mono-repo-bff

  # Server Configuration
  server:
    port: ${SERVER_PORT:8080}
    servlet:
      context-path: ${SERVER_SERVLET_CONTEXT_PATH:/}
      session:
        cookie:
          http-only: true
          secure: true
          same-site: strict
          max-age: 30m

  # MongoDB Configuration
  data:
    mongodb:
      uri: ${SPRING_DATA_MONGODB_URI:mongodb://localhost:27017/hs_mono_repo?authSource=admin}
      database: ${SPRING_DATA_MONGODB_DATABASE:hs_mono_repo}

    # Redis Configuration
    redis:
      host: ${SPRING_DATA_REDIS_HOST:localhost}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      password: ${SPRING_DATA_REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

  # Session Configuration
  session:
    store-type: redis
    redis:
      namespace: spring:session
      flush-mode: on_save
    timeout: ${SESSION_TIMEOUT_MINUTES:30}m

  # Security - OAuth2 Client Configuration
  security:
    oauth2:
      client:
        registration:
          idp:
            client-id: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_IDP_CLIENT_ID:your-client-id}
            client-secret: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_IDP_CLIENT_SECRET:your-client-secret}
            scope: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_IDP_SCOPE:openid,profile,email}
            authorization-grant-type: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_IDP_AUTHORIZATION_GRANT_TYPE:authorization_code}
            redirect-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_IDP_REDIRECT_URI:http://localhost:4202/auth/callback}

        provider:
          idp:
            issuer-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_IDP_ISSUER_URI:https://your-idp.example.com}
            authorization-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_IDP_AUTHORIZATION_URI:https://your-idp.example.com/oauth2/authorize}
            token-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_IDP_TOKEN_URI:https://your-idp.example.com/oauth2/token}
            user-info-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_IDP_USER_INFO_URI:https://your-idp.example.com/oauth2/userinfo}
            jwk-set-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_IDP_JWK_SET_URI:https://your-idp.example.com/oauth2/jwks}
            user-name-attribute: sub

# US (User Service) OAuth2 Client Credentials Configuration
us:
  oauth2:
    token-uri: ${US_OAUTH2_TOKEN_URI:https://us.example.com/oauth2/token}
    biometric-uri: ${US_OAUTH2_BIOMETRIC_URI:https://us.example.com/api/v1/biometric}
    client-id: ${US_OAUTH2_CLIENT_ID:your-us-client-id}
    client-secret: ${US_OAUTH2_CLIENT_SECRET:your-us-client-secret}
    scope: ${US_OAUTH2_SCOPE:us.biometric.read}

# PSN (Provider Service Network) OAuth2 Client Credentials Configuration
psn:
  oauth2:
    token-uri: ${PSN_OAUTH2_TOKEN_URI:https://psn.example.com/oauth2/token}
    access-level-uri: ${PSN_OAUTH2_ACCESS_LEVEL_URI:https://psn.example.com/api/v1/access-level}
    client-id: ${PSN_OAUTH2_CLIENT_ID:your-psn-client-id}
    client-secret: ${PSN_OAUTH2_CLIENT_SECRET:your-psn-client-secret}
    scope: ${PSN_OAUTH2_SCOPE:psn.access_level.read}

# Custom Session Configuration
session:
  timeout:
    minutes: ${SESSION_TIMEOUT_MINUTES:30}
  refresh:
    threshold:
      seconds: ${SESSION_REFRESH_THRESHOLD_SECONDS:300}

# Cache Configuration
# US and PSN API responses are cached in Redis for 30 minutes
# Cache keys:
#   - us:biometric:{hsid} - Biometric information from US
#   - psn:access-level:{memberIdType}:{memberIdValue} - Access level from PSN
cache:
  us:
    ttl:
      minutes: 30
  psn:
    ttl:
      minutes: 30

# AWS S3 Configuration for Document Management
aws:
  accessKeyId: ${AWS_ACCESS_KEY_ID:}
  secretAccessKey: ${AWS_SECRET_ACCESS_KEY:}
  s3:
    documents:
      bucket: ${AWS_S3_DOCUMENTS_BUCKET:hs-documents-dev}
      region: ${AWS_REGION:us-east-1}
      upload-url-expiration-minutes: ${AWS_S3_UPLOAD_URL_EXPIRATION_MINUTES:15}
      download-url-expiration-minutes: ${AWS_S3_DOWNLOAD_URL_EXPIRATION_MINUTES:15}

# Logging Configuration
logging:
  level:
    root: ${LOGGING_LEVEL_ROOT:INFO}
    com.example.demo: ${LOGGING_LEVEL_COM_EXAMPLE_DEMO:DEBUG}
    org.springframework.security: ${LOGGING_LEVEL_SPRING_SECURITY:DEBUG}
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized

# Active Profile
---
spring:
  config:
    activate:
      on-profile: development

  # Development-specific settings
  devtools:
    restart:
      enabled: true
    livereload:
      enabled: true

logging:
  level:
    com.example.demo: DEBUG
    org.springframework.security: DEBUG

---
spring:
  config:
    activate:
      on-profile: staging

  # Staging-specific settings
  server:
    servlet:
      session:
        cookie:
          secure: true
          domain: .staging.example.com

logging:
  level:
    com.example.demo: INFO
    org.springframework.security: INFO

---
spring:
  config:
    activate:
      on-profile: production

  # Production-specific settings
  server:
    servlet:
      session:
        cookie:
          secure: true
          domain: .example.com

logging:
  level:
    root: WARN
    com.example.demo: INFO
    org.springframework.security: WARN
